<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Chloneda</title>
    <link>https://chloneda.github.io/</link>
    <atom:link href="/rss2.html" rel="self" type="application/rss+xml"/>
    
    <description>Less is more</description>
    <pubDate>Sun, 19 May 2019 14:53:29 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>深入浅出Mybatis系列五-TypeHandler简介及配置（mybatis源码篇）</title>
      <link>https://chloneda.github.io//blog/mybatis-5/</link>
      <guid>https://chloneda.github.io//blog/mybatis-5/</guid>
      <pubDate>Sun, 19 May 2019 14:53:29 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;注：本文转载自&lt;a href=&quot;https://www.cnblogs.com/dongying/p/4040435.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;南轲梦&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;上篇文章《深入浅出Mybatis系列（四）—配置详解
        
      
      </description>
      
      <content:encoded><![CDATA[<p>注：本文转载自<a href="https://www.cnblogs.com/dongying/p/4040435.html" target="_blank" rel="noopener">南轲梦</a></p><p>上篇文章《深入浅出Mybatis系列（四）—配置详解之typeAliases别名（mybatis源码篇）》为大家介绍了mybatis中别名的使用，以及其源码。本篇将为大家介绍TypeHandler， 并简单分析其源码。</p><p>Mybatis中的TypeHandler是什么？</p><p>无论是 MyBatis 在预处理语句（PreparedStatement）中设置一个参数时，还是从结果集中取出一个值时，都会用类型处理器将获取的值以合适的方式转换成 Java 类型。Mybatis默认为我们实现了许多TypeHandler, 当我们没有配置指定TypeHandler时，Mybatis会根据参数或者返回结果的不同，默认为我们选择合适的TypeHandler处理。</p><p>那么，Mybatis为我们实现了哪些TypeHandler呢?  我们怎么自定义实现一个TypeHandler ?  这些都会在接下来的mybatis的源码中看到。</p><p>在看源码之前，还是像之前一样，先看看怎么配置吧？</p><h1 id="配置TypeHandler"><a href="#配置TypeHandler" class="headerlink" title="配置TypeHandler"></a>配置TypeHandler</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">          当配置package的时候，mybatis会去配置的package扫描TypeHandler</span></span><br><span class="line"><span class="comment">          &lt;package name="com.dy.demo"/&gt;</span></span><br><span class="line"><span class="comment">       --&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">&lt;!-- handler属性直接配置我们要指定的TypeHandler --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">          javaType 配置java类型，例如String, 如果配上javaType, </span></span><br><span class="line"><span class="comment">　那么指定的typeHandler就只作用于指定的类型 </span></span><br><span class="line"><span class="comment">　　　　--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">javaType</span>=<span class="string">""</span> <span class="attr">handler</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">          jdbcType 配置数据库基本数据类型，例如varchar, 如果配上jdbcType,</span></span><br><span class="line"><span class="comment">　　　　　  那么指定的typeHandler就只作用于指定的类型  </span></span><br><span class="line"><span class="comment">　　　　--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">jdbcType</span>=<span class="string">""</span> <span class="attr">handler</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">&lt;!-- 也可两者都配置 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">javaType</span>=<span class="string">""</span> <span class="attr">jdbcType</span>=<span class="string">""</span> <span class="attr">handler</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">      </span><br><span class="line">  <span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  ......</span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>上面简单介绍了一下TypeHandler,  下面就看看mybatis中TypeHandler的源码了。</p><p>老规矩，先从对xml的解析讲起：</p><h1 id="typeHandlers节点源码"><a href="#typeHandlers节点源码" class="headerlink" title="typeHandlers节点源码"></a>typeHandlers节点源码</h1><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解析typeHandlers节点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> typeHandlerElement(XNode parent) throws Exception &#123;</span><br><span class="line">    <span class="built_in">if</span> (parent != null) &#123;</span><br><span class="line">      <span class="built_in">for</span> (XNode child : parent.getChildren()) &#123;</span><br><span class="line">        <span class="comment">//子节点为package时，获取其name属性的值，然后自动扫描package下的自定义typeHandler</span></span><br><span class="line">        <span class="built_in">if</span> (<span class="string">"package"</span>.equals(child.getName())) &#123;</span><br><span class="line">          <span class="keyword">String</span> typeHandlerPackage = child.getStringAttribute(<span class="string">"name"</span>);</span><br><span class="line">          typeHandlerRegistry.<span class="keyword">register</span>(typeHandlerPackage);</span><br><span class="line">        &#125; <span class="built_in">else</span> &#123;</span><br><span class="line">          <span class="comment">/**</span></span><br><span class="line"><span class="comment">          * 子节点为typeHandler时， 可以指定javaType属性， </span></span><br><span class="line"><span class="comment">          * 也可以指定jdbcType, 也可两者都指定</span></span><br><span class="line"><span class="comment">          * javaType 是指定java类型</span></span><br><span class="line"><span class="comment">          * jdbcType 是指定jdbc类型（数据库类型： 如varchar）</span></span><br><span class="line"><span class="comment">          */</span></span><br><span class="line">          <span class="keyword">String</span> javaTypeName = child.getStringAttribute(<span class="string">"javaType"</span>);</span><br><span class="line">          <span class="keyword">String</span> jdbcTypeName = child.getStringAttribute(<span class="string">"jdbcType"</span>);</span><br><span class="line">          <span class="comment">//handler就是我们配置的typeHandler</span></span><br><span class="line">          <span class="keyword">String</span> handlerTypeName = child.getStringAttribute(<span class="string">"handler"</span>);</span><br><span class="line"></span><br><span class="line">          <span class="comment">//resolveClass方法就是我们上篇文章所讲的TypeAliasRegistry里面处理别名的方法</span></span><br><span class="line">          Class&lt;?&gt; javaTypeClass = resolveClass(javaTypeName);</span><br><span class="line">          <span class="comment">//JdbcType是一个枚举类型，resolveJdbcType方法是在获取枚举类型的值</span></span><br><span class="line">          JdbcType jdbcType = resolveJdbcType(jdbcTypeName);</span><br><span class="line">          Class&lt;?&gt; typeHandlerClass = resolveClass(handlerTypeName);</span><br><span class="line"></span><br><span class="line">          <span class="comment">//注册typeHandler, typeHandler通过TypeHandlerRegistry这个类管理</span></span><br><span class="line">          <span class="built_in">if</span> (javaTypeClass != null) &#123;</span><br><span class="line">            <span class="built_in">if</span> (jdbcType == null) &#123;</span><br><span class="line">              typeHandlerRegistry.<span class="keyword">register</span>(javaTypeClass, typeHandlerClass);</span><br><span class="line">            &#125; <span class="built_in">else</span> &#123;</span><br><span class="line">              typeHandlerRegistry.<span class="keyword">register</span>(javaTypeClass, jdbcType, typeHandlerClass);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125; <span class="built_in">else</span> &#123;</span><br><span class="line">            typeHandlerRegistry.<span class="keyword">register</span>(typeHandlerClass);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来看看TypeHandler的管理注册类：</p><h1 id="TypeHandlerRegistry源码"><a href="#TypeHandlerRegistry源码" class="headerlink" title="TypeHandlerRegistry源码"></a>TypeHandlerRegistry源码</h1><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * typeHandler注册管理类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> TypeHandlerRegistry &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//源码一上来，二话不说，几个大大的HashMap就出现，这不又跟上次讲的typeAliases的注册类似么</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//基本数据类型与其包装类</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;<span class="keyword">Class</span>&lt;?&gt;, <span class="keyword">Class</span>&lt;?&gt;&gt; reversePrimitiveMap </span><br><span class="line">= <span class="keyword">new</span> HashMap&lt;<span class="keyword">Class</span>&lt;?&gt;, <span class="keyword">Class</span>&lt;?&gt;&gt;() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1</span>L;</span><br><span class="line">    &#123;</span><br><span class="line">      put(<span class="keyword">Byte</span>.<span class="keyword">class</span>, <span class="keyword">byte</span>.<span class="keyword">class</span>);</span><br><span class="line">      put(<span class="keyword">Short</span>.<span class="keyword">class</span>, <span class="keyword">short</span>.<span class="keyword">class</span>);</span><br><span class="line">      put(Integer.<span class="keyword">class</span>, <span class="keyword">int</span>.<span class="keyword">class</span>);</span><br><span class="line">      put(<span class="keyword">Long</span>.<span class="keyword">class</span>, <span class="keyword">long</span>.<span class="keyword">class</span>);</span><br><span class="line">      put(<span class="keyword">Float</span>.<span class="keyword">class</span>, <span class="keyword">float</span>.<span class="keyword">class</span>);</span><br><span class="line">      put(<span class="keyword">Double</span>.<span class="keyword">class</span>, <span class="keyword">double</span>.<span class="keyword">class</span>);</span><br><span class="line">      put(<span class="keyword">Boolean</span>.<span class="keyword">class</span>, <span class="keyword">boolean</span>.<span class="keyword">class</span>);</span><br><span class="line">      put(Character.<span class="keyword">class</span>, <span class="keyword">char</span>.<span class="keyword">class</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//这几个MAP不用说就知道存的是什么东西吧，命名的好处</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;JdbcType, TypeHandler&lt;?&gt;&gt; JDBC_TYPE_HANDLER_MAP </span><br><span class="line">= <span class="keyword">new</span> EnumMap&lt;JdbcType, TypeHandler&lt;?&gt;&gt;(JdbcType.<span class="keyword">class</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Type, Map&lt;JdbcType, TypeHandler&lt;?&gt;&gt;&gt; TYPE_HANDLER_MAP </span><br><span class="line">= <span class="keyword">new</span> HashMap&lt;Type, Map&lt;JdbcType, TypeHandler&lt;?&gt;&gt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> TypeHandler&lt;Object&gt; UNKNOWN_TYPE_HANDLER </span><br><span class="line">= <span class="keyword">new</span> UnknownTypeHandler(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;<span class="keyword">Class</span>&lt;?&gt;, TypeHandler&lt;?&gt;&gt; ALL_TYPE_HANDLERS_MAP </span><br><span class="line">= <span class="keyword">new</span> HashMap&lt;<span class="keyword">Class</span>&lt;?&gt;, TypeHandler&lt;?&gt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//就像上篇文章讲的typeAliases一样，mybatis也默认给我们注册了不少的typeHandler</span></span><br><span class="line">  <span class="comment">//具体如下</span></span><br><span class="line">  <span class="keyword">public</span> TypeHandlerRegistry() &#123;</span><br><span class="line">    register(<span class="keyword">Boolean</span>.<span class="keyword">class</span>, <span class="keyword">new</span> BooleanTypeHandler());</span><br><span class="line">    register(<span class="keyword">boolean</span>.<span class="keyword">class</span>, <span class="keyword">new</span> BooleanTypeHandler());</span><br><span class="line">    register(JdbcType.<span class="keyword">BOOLEAN</span>, <span class="keyword">new</span> BooleanTypeHandler());</span><br><span class="line">    register(JdbcType.BIT, <span class="keyword">new</span> BooleanTypeHandler());</span><br><span class="line"></span><br><span class="line">    register(<span class="keyword">Byte</span>.<span class="keyword">class</span>, <span class="keyword">new</span> ByteTypeHandler());</span><br><span class="line">    register(<span class="keyword">byte</span>.<span class="keyword">class</span>, <span class="keyword">new</span> ByteTypeHandler());</span><br><span class="line">    register(JdbcType.TINYINT, <span class="keyword">new</span> ByteTypeHandler());</span><br><span class="line"></span><br><span class="line">    register(<span class="keyword">Short</span>.<span class="keyword">class</span>, <span class="keyword">new</span> ShortTypeHandler());</span><br><span class="line">    register(<span class="keyword">short</span>.<span class="keyword">class</span>, <span class="keyword">new</span> ShortTypeHandler());</span><br><span class="line">    register(JdbcType.SMALLINT, <span class="keyword">new</span> ShortTypeHandler());</span><br><span class="line"></span><br><span class="line">    register(Integer.<span class="keyword">class</span>, <span class="keyword">new</span> IntegerTypeHandler());</span><br><span class="line">    register(<span class="keyword">int</span>.<span class="keyword">class</span>, <span class="keyword">new</span> IntegerTypeHandler());</span><br><span class="line">    register(JdbcType.INTEGER, <span class="keyword">new</span> IntegerTypeHandler());</span><br><span class="line"></span><br><span class="line">    register(<span class="keyword">Long</span>.<span class="keyword">class</span>, <span class="keyword">new</span> LongTypeHandler());</span><br><span class="line">    register(<span class="keyword">long</span>.<span class="keyword">class</span>, <span class="keyword">new</span> LongTypeHandler());</span><br><span class="line"></span><br><span class="line">    register(<span class="keyword">Float</span>.<span class="keyword">class</span>, <span class="keyword">new</span> FloatTypeHandler());</span><br><span class="line">    register(<span class="keyword">float</span>.<span class="keyword">class</span>, <span class="keyword">new</span> FloatTypeHandler());</span><br><span class="line">    register(JdbcType.<span class="keyword">FLOAT</span>, <span class="keyword">new</span> FloatTypeHandler());</span><br><span class="line"></span><br><span class="line">    register(<span class="keyword">Double</span>.<span class="keyword">class</span>, <span class="keyword">new</span> DoubleTypeHandler());</span><br><span class="line">    register(<span class="keyword">double</span>.<span class="keyword">class</span>, <span class="keyword">new</span> DoubleTypeHandler());</span><br><span class="line">    register(JdbcType.<span class="keyword">DOUBLE</span>, <span class="keyword">new</span> DoubleTypeHandler());</span><br><span class="line"></span><br><span class="line">    register(String.<span class="keyword">class</span>, <span class="keyword">new</span> StringTypeHandler());</span><br><span class="line">    register(String.<span class="keyword">class</span>, JdbcType.<span class="keyword">CHAR</span>, <span class="keyword">new</span> StringTypeHandler());</span><br><span class="line">    register(String.<span class="keyword">class</span>, JdbcType.CLOB, <span class="keyword">new</span> ClobTypeHandler());</span><br><span class="line">    register(String.<span class="keyword">class</span>, JdbcType.VARCHAR, <span class="keyword">new</span> StringTypeHandler());</span><br><span class="line">    register(String.<span class="keyword">class</span>, JdbcType.LONGVARCHAR, <span class="keyword">new</span> ClobTypeHandler());</span><br><span class="line">    register(String.<span class="keyword">class</span>, JdbcType.NVARCHAR, <span class="keyword">new</span> NStringTypeHandler());</span><br><span class="line">    register(String.<span class="keyword">class</span>, JdbcType.NCHAR, <span class="keyword">new</span> NStringTypeHandler());</span><br><span class="line">    register(String.<span class="keyword">class</span>, JdbcType.NCLOB, <span class="keyword">new</span> NClobTypeHandler());</span><br><span class="line">    register(JdbcType.<span class="keyword">CHAR</span>, <span class="keyword">new</span> StringTypeHandler());</span><br><span class="line">    register(JdbcType.VARCHAR, <span class="keyword">new</span> StringTypeHandler());</span><br><span class="line">    register(JdbcType.CLOB, <span class="keyword">new</span> ClobTypeHandler());</span><br><span class="line">    register(JdbcType.LONGVARCHAR, <span class="keyword">new</span> ClobTypeHandler());</span><br><span class="line">    register(JdbcType.NVARCHAR, <span class="keyword">new</span> NStringTypeHandler());</span><br><span class="line">    register(JdbcType.NCHAR, <span class="keyword">new</span> NStringTypeHandler());</span><br><span class="line">    register(JdbcType.NCLOB, <span class="keyword">new</span> NClobTypeHandler());</span><br><span class="line"></span><br><span class="line">    register(Object.<span class="keyword">class</span>, JdbcType.ARRAY, <span class="keyword">new</span> ArrayTypeHandler());</span><br><span class="line">    register(JdbcType.ARRAY, <span class="keyword">new</span> ArrayTypeHandler());</span><br><span class="line"></span><br><span class="line">    register(BigInteger.<span class="keyword">class</span>, <span class="keyword">new</span> BigIntegerTypeHandler());</span><br><span class="line">    register(JdbcType.BIGINT, <span class="keyword">new</span> LongTypeHandler());</span><br><span class="line"></span><br><span class="line">    register(BigDecimal.<span class="keyword">class</span>, <span class="keyword">new</span> BigDecimalTypeHandler());</span><br><span class="line">    register(JdbcType.REAL, <span class="keyword">new</span> BigDecimalTypeHandler());</span><br><span class="line">    register(JdbcType.DECIMAL, <span class="keyword">new</span> BigDecimalTypeHandler());</span><br><span class="line">    register(JdbcType.NUMERIC, <span class="keyword">new</span> BigDecimalTypeHandler());</span><br><span class="line"></span><br><span class="line">    register(<span class="keyword">Byte</span>[].<span class="keyword">class</span>, <span class="keyword">new</span> ByteObjectArrayTypeHandler());</span><br><span class="line">    register(<span class="keyword">Byte</span>[].<span class="keyword">class</span>, JdbcType.BLOB, <span class="keyword">new</span> BlobByteObjectArrayTypeHandler());</span><br><span class="line">    register(<span class="keyword">Byte</span>[].<span class="keyword">class</span>, JdbcType.LONGVARBINARY,<span class="keyword">new</span> BlobByteObjectArrayTypeHandler());</span><br><span class="line">    register(<span class="keyword">byte</span>[].<span class="keyword">class</span>, <span class="keyword">new</span> ByteArrayTypeHandler());</span><br><span class="line">    register(<span class="keyword">byte</span>[].<span class="keyword">class</span>, JdbcType.BLOB, <span class="keyword">new</span> BlobTypeHandler());</span><br><span class="line">    register(<span class="keyword">byte</span>[].<span class="keyword">class</span>, JdbcType.LONGVARBINARY, <span class="keyword">new</span> BlobTypeHandler());</span><br><span class="line">    register(JdbcType.LONGVARBINARY, <span class="keyword">new</span> BlobTypeHandler());</span><br><span class="line">    register(JdbcType.BLOB, <span class="keyword">new</span> BlobTypeHandler());</span><br><span class="line"></span><br><span class="line">    register(Object.<span class="keyword">class</span>, UNKNOWN_TYPE_HANDLER);</span><br><span class="line">    register(Object.<span class="keyword">class</span>, JdbcType.OTHER, UNKNOWN_TYPE_HANDLER);</span><br><span class="line">    register(JdbcType.OTHER, UNKNOWN_TYPE_HANDLER);</span><br><span class="line"></span><br><span class="line">    register(Date.<span class="keyword">class</span>, <span class="keyword">new</span> DateTypeHandler());</span><br><span class="line">    register(Date.<span class="keyword">class</span>, JdbcType.DATE, <span class="keyword">new</span> DateOnlyTypeHandler());</span><br><span class="line">    register(Date.<span class="keyword">class</span>, JdbcType.TIME, <span class="keyword">new</span> TimeOnlyTypeHandler());</span><br><span class="line">    register(JdbcType.TIMESTAMP, <span class="keyword">new</span> DateTypeHandler());</span><br><span class="line">    register(JdbcType.DATE, <span class="keyword">new</span> DateOnlyTypeHandler());</span><br><span class="line">    register(JdbcType.TIME, <span class="keyword">new</span> TimeOnlyTypeHandler());</span><br><span class="line"></span><br><span class="line">    register(java.sql.Date.<span class="keyword">class</span>, <span class="keyword">new</span> SqlDateTypeHandler());</span><br><span class="line">    register(java.sql.Time.<span class="keyword">class</span>, <span class="keyword">new</span> SqlTimeTypeHandler());</span><br><span class="line">    register(java.sql.Timestamp.<span class="keyword">class</span>, <span class="keyword">new</span> SqlTimestampTypeHandler());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// issue #273</span></span><br><span class="line">    register(Character.<span class="keyword">class</span>, <span class="keyword">new</span> CharacterTypeHandler());</span><br><span class="line">    register(<span class="keyword">char</span>.<span class="keyword">class</span>, <span class="keyword">new</span> CharacterTypeHandler());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">boolean</span> hasTypeHandler(<span class="keyword">Class</span>&lt;?&gt; javaType) &#123;</span><br><span class="line">    <span class="keyword">return</span> hasTypeHandler(javaType, <span class="keyword">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">boolean</span> hasTypeHandler(TypeReference&lt;?&gt; javaTypeReference) &#123;</span><br><span class="line">    <span class="keyword">return</span> hasTypeHandler(javaTypeReference, <span class="keyword">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">boolean</span> hasTypeHandler(<span class="keyword">Class</span>&lt;?&gt; javaType, JdbcType jdbcType) &#123;</span><br><span class="line">    <span class="keyword">return</span> javaType != <span class="keyword">null</span> &amp;&amp; getTypeHandler((Type) javaType, jdbcType) != <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">boolean</span> hasTypeHandler(TypeReference&lt;?&gt; javaTypeReference,</span><br><span class="line">JdbcType jdbcType) &#123;</span><br><span class="line">    <span class="keyword">return</span> javaTypeReference != <span class="keyword">null</span> </span><br><span class="line">&amp;&amp; getTypeHandler(javaTypeReference, jdbcType) != <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> TypeHandler&lt;?&gt; getMappingTypeHandler(</span><br><span class="line"><span class="keyword">Class</span>&lt;? <span class="keyword">extends</span> TypeHandler&lt;?&gt;&gt; handlerType) &#123;</span><br><span class="line">    <span class="keyword">return</span> ALL_TYPE_HANDLERS_MAP.get(handlerType);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> &lt;T&gt; TypeHandler&lt;T&gt; getTypeHandler(<span class="keyword">Class</span>&lt;T&gt; type) &#123;</span><br><span class="line">    <span class="keyword">return</span> getTypeHandler((Type) type, <span class="keyword">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> &lt;T&gt; TypeHandler&lt;T&gt; getTypeHandler(TypeReference&lt;T&gt; javaTypeReference) &#123;</span><br><span class="line">    <span class="keyword">return</span> getTypeHandler(javaTypeReference, <span class="keyword">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> TypeHandler&lt;?&gt; getTypeHandler(JdbcType jdbcType) &#123;</span><br><span class="line">    <span class="keyword">return</span> JDBC_TYPE_HANDLER_MAP.get(jdbcType);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> &lt;T&gt; TypeHandler&lt;T&gt; getTypeHandler(<span class="keyword">Class</span>&lt;T&gt; type, JdbcType jdbcType) &#123;</span><br><span class="line">    <span class="keyword">return</span> getTypeHandler((Type) type, jdbcType);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> &lt;T&gt; TypeHandler&lt;T&gt; getTypeHandler(</span><br><span class="line">TypeReference&lt;T&gt; javaTypeReference, JdbcType jdbcType) &#123;</span><br><span class="line">    <span class="keyword">return</span> getTypeHandler(javaTypeReference.getRawType(), jdbcType);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> &lt;T&gt; TypeHandler&lt;T&gt; getTypeHandler(Type type, JdbcType jdbcType) &#123;</span><br><span class="line">    Map&lt;JdbcType, TypeHandler&lt;?&gt;&gt; jdbcHandlerMap = TYPE_HANDLER_MAP.get(type);</span><br><span class="line">    TypeHandler&lt;?&gt; handler = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (jdbcHandlerMap != <span class="keyword">null</span>) &#123;</span><br><span class="line">      handler = jdbcHandlerMap.get(jdbcType);</span><br><span class="line">      <span class="keyword">if</span> (handler == <span class="keyword">null</span>) &#123;</span><br><span class="line">        handler = jdbcHandlerMap.get(<span class="keyword">null</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (handler == <span class="keyword">null</span> </span><br><span class="line">&amp;&amp; type != <span class="keyword">null</span> </span><br><span class="line">&amp;&amp; type <span class="keyword">instanceof</span> <span class="keyword">Class</span> </span><br><span class="line">&amp;&amp; Enum.<span class="keyword">class</span>.isAssignableFrom((<span class="keyword">Class</span>&lt;?&gt;) type)) &#123;</span><br><span class="line">      handler = <span class="keyword">new</span> EnumTypeHandler((<span class="keyword">Class</span>&lt;?&gt;) type);</span><br><span class="line">    &#125;</span><br><span class="line">    @SuppressWarnings(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="comment">// type drives generics here</span></span><br><span class="line">    TypeHandler&lt;T&gt; returned = (TypeHandler&lt;T&gt;) handler;</span><br><span class="line">    <span class="keyword">return</span> returned;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> TypeHandler&lt;Object&gt; getUnknownTypeHandler() &#123;</span><br><span class="line">    <span class="keyword">return</span> UNKNOWN_TYPE_HANDLER;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> register(JdbcType jdbcType, TypeHandler&lt;?&gt; handler) &#123;</span><br><span class="line">    JDBC_TYPE_HANDLER_MAP.put(jdbcType, handler);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// REGISTER INSTANCE</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 只配置了typeHandler, 没有配置jdbcType 或者javaType</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  @SuppressWarnings(<span class="string">"unchecked"</span>)</span><br><span class="line">  <span class="keyword">public</span> &lt;T&gt; <span class="keyword">void</span> register(TypeHandler&lt;T&gt; typeHandler) &#123;</span><br><span class="line">    <span class="keyword">boolean</span> mappedTypeFound = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">//在自定义typeHandler的时候，可以加上注解MappedTypes 去指定关联的javaType</span></span><br><span class="line">    <span class="comment">//因此，此处需要扫描MappedTypes注解</span></span><br><span class="line">    MappedTypes mappedTypes = typeHandler.getClass().getAnnotation(MappedTypes.<span class="keyword">class</span>);</span><br><span class="line">    <span class="keyword">if</span> (mappedTypes != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">Class</span>&lt;?&gt; handledType : mappedTypes.value()) &#123;</span><br><span class="line">        register(handledType, typeHandler);</span><br><span class="line">        mappedTypeFound = <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// @since 3.1.0 - try to auto-discover the mapped type</span></span><br><span class="line">    <span class="keyword">if</span> (!mappedTypeFound &amp;&amp; typeHandler <span class="keyword">instanceof</span> TypeReference) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        TypeReference&lt;T&gt; typeReference = (TypeReference&lt;T&gt;) typeHandler;</span><br><span class="line">        register(typeReference.getRawType(), typeHandler);</span><br><span class="line">        mappedTypeFound = <span class="keyword">true</span>;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * maybe users define the TypeReference with a different </span></span><br><span class="line"><span class="comment">        * type and are not assignable, so just ignore it</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!mappedTypeFound) &#123;</span><br><span class="line">      register((<span class="keyword">Class</span>&lt;T&gt;) <span class="keyword">null</span>, typeHandler);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 配置了typeHandlerhe和javaType</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> &lt;T&gt; <span class="keyword">void</span> register(<span class="keyword">Class</span>&lt;T&gt; javaType, TypeHandler&lt;? <span class="keyword">extends</span> T&gt; typeHandler) &#123;</span><br><span class="line">    register((Type) javaType, typeHandler);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> &lt;T&gt; <span class="keyword">void</span> register(Type javaType, TypeHandler&lt;? <span class="keyword">extends</span> T&gt; typeHandler) &#123;</span><br><span class="line">    <span class="comment">//扫描注解MappedJdbcTypes</span></span><br><span class="line">    MappedJdbcTypes mappedJdbcTypes </span><br><span class="line">= typeHandler.getClass().getAnnotation(MappedJdbcTypes.<span class="keyword">class</span>);</span><br><span class="line">    <span class="keyword">if</span> (mappedJdbcTypes != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (JdbcType handledJdbcType : mappedJdbcTypes.value()) &#123;</span><br><span class="line">        register(javaType, handledJdbcType, typeHandler);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (mappedJdbcTypes.includeNullJdbcType()) &#123;</span><br><span class="line">        register(javaType, <span class="keyword">null</span>, typeHandler);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      register(javaType, <span class="keyword">null</span>, typeHandler);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> &lt;T&gt; <span class="keyword">void</span> register(TypeReference&lt;T&gt; javaTypeReference, </span><br><span class="line">TypeHandler&lt;? <span class="keyword">extends</span> T&gt; handler) &#123;</span><br><span class="line">    register(javaTypeReference.getRawType(), handler);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * typeHandlerhe、javaType、jdbcType都配置了</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> &lt;T&gt; <span class="keyword">void</span> register(<span class="keyword">Class</span>&lt;T&gt; type, </span><br><span class="line">JdbcType jdbcType, </span><br><span class="line">TypeHandler&lt;? <span class="keyword">extends</span> T&gt; handler) &#123;</span><br><span class="line">    register((Type) type, jdbcType, handler);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 注册typeHandler的核心方法</span></span><br><span class="line"><span class="comment">   * 就是向Map新增数据而已</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> register(Type javaType, JdbcType jdbcType, TypeHandler&lt;?&gt; handler) &#123;</span><br><span class="line">    <span class="keyword">if</span> (javaType != <span class="keyword">null</span>) &#123;</span><br><span class="line">      Map&lt;JdbcType, TypeHandler&lt;?&gt;&gt; map = TYPE_HANDLER_MAP.get(javaType);</span><br><span class="line">      <span class="keyword">if</span> (map == <span class="keyword">null</span>) &#123;</span><br><span class="line">        map = <span class="keyword">new</span> HashMap&lt;JdbcType, TypeHandler&lt;?&gt;&gt;();</span><br><span class="line">        TYPE_HANDLER_MAP.put(javaType, map);</span><br><span class="line">      &#125;</span><br><span class="line">      map.put(jdbcType, handler);</span><br><span class="line">      <span class="keyword">if</span> (reversePrimitiveMap.containsKey(javaType)) &#123;</span><br><span class="line">        register(reversePrimitiveMap.get(javaType), jdbcType, handler);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ALL_TYPE_HANDLERS_MAP.put(handler.getClass(), handler);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// REGISTER CLASS</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Only handler type</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> register(<span class="keyword">Class</span>&lt;?&gt; typeHandlerClass) &#123;</span><br><span class="line">    <span class="keyword">boolean</span> mappedTypeFound = <span class="keyword">false</span>;</span><br><span class="line">    MappedTypes mappedTypes = typeHandlerClass.getAnnotation(MappedTypes.<span class="keyword">class</span>);</span><br><span class="line">    <span class="keyword">if</span> (mappedTypes != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">Class</span>&lt;?&gt; javaTypeClass : mappedTypes.value()) &#123;</span><br><span class="line">        register(javaTypeClass, typeHandlerClass);</span><br><span class="line">        mappedTypeFound = <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!mappedTypeFound) &#123;</span><br><span class="line">      register(getInstance(<span class="keyword">null</span>, typeHandlerClass));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// java type + handler type</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> register(<span class="keyword">Class</span>&lt;?&gt; javaTypeClass, <span class="keyword">Class</span>&lt;?&gt; typeHandlerClass) &#123;</span><br><span class="line">    register(javaTypeClass, getInstance(javaTypeClass, typeHandlerClass));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// java type + jdbc type + handler type</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> register(<span class="keyword">Class</span>&lt;?&gt; javaTypeClass, </span><br><span class="line">JdbcType jdbcType, </span><br><span class="line"><span class="keyword">Class</span>&lt;?&gt; typeHandlerClass) &#123;</span><br><span class="line">    register(javaTypeClass, jdbcType, getInstance(javaTypeClass, typeHandlerClass));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Construct a handler (used also from Builders)</span></span><br><span class="line"></span><br><span class="line">  @SuppressWarnings(<span class="string">"unchecked"</span>)</span><br><span class="line">  <span class="keyword">public</span> &lt;T&gt; TypeHandler&lt;T&gt; getInstance(<span class="keyword">Class</span>&lt;?&gt; javaTypeClass, </span><br><span class="line"><span class="keyword">Class</span>&lt;?&gt; typeHandlerClass) &#123;</span><br><span class="line">    <span class="keyword">if</span> (javaTypeClass != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        Constructor&lt;?&gt; c = typeHandlerClass.getConstructor(<span class="keyword">Class</span>.<span class="keyword">class</span>);</span><br><span class="line">        <span class="keyword">return</span> (TypeHandler&lt;T&gt;) c.newInstance(javaTypeClass);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (NoSuchMethodException ignored) &#123;</span><br><span class="line">        <span class="comment">// ignored</span></span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> TypeException(<span class="string">"Failed invoking constructor for handler "</span> </span><br><span class="line">+ typeHandlerClass, e);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      Constructor&lt;?&gt; c = typeHandlerClass.getConstructor();</span><br><span class="line">      <span class="keyword">return</span> (TypeHandler&lt;T&gt;) c.newInstance();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> TypeException(<span class="string">"Unable to find a usable constructor for "</span> </span><br><span class="line">+ typeHandlerClass, e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 根据指定的pacakge去扫描自定义的typeHander，然后注册</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> register(String packageName) &#123;</span><br><span class="line">    ResolverUtil&lt;<span class="keyword">Class</span>&lt;?&gt;&gt; resolverUtil = <span class="keyword">new</span> ResolverUtil&lt;<span class="keyword">Class</span>&lt;?&gt;&gt;();</span><br><span class="line">    resolverUtil.<span class="keyword">find</span>(<span class="keyword">new</span> ResolverUtil.IsA(TypeHandler.<span class="keyword">class</span>), packageName);</span><br><span class="line">    Set&lt;<span class="keyword">Class</span>&lt;? <span class="keyword">extends</span> <span class="keyword">Class</span>&lt;?&gt;&gt;&gt; handlerSet = resolverUtil.getClasses();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">Class</span>&lt;?&gt; type : handlerSet) &#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * Ignore inner classes and interfaces (including package-info.java) </span></span><br><span class="line"><span class="comment">      * and abstract classes</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      <span class="keyword">if</span> (!type.isAnonymousClass() </span><br><span class="line">&amp;&amp; !type.isInterface() </span><br><span class="line">&amp;&amp; !Modifier.isAbstract(type.getModifiers())) &#123;</span><br><span class="line">        register(type);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// get information</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 通过configuration对象可以获取已注册的所有typeHandler</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> Collection&lt;TypeHandler&lt;?&gt;&gt; getTypeHandlers() &#123;</span><br><span class="line">    <span class="keyword">return</span> Collections.unmodifiableCollection(ALL_TYPE_HANDLERS_MAP.values());</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由源码可以看到， mybatis为我们实现了那么多TypeHandler,  随便打开一个TypeHandler，看其源码，都可以看到，它继承自一个抽象类：BaseTypeHandler， 那么我们是不是也能通过继承BaseTypeHandler，从而实现自定义的TypeHandler ? 答案是肯定的， 那么现在下面就为大家演示一下自定义TypeHandler:</p><h1 id="自定义TypeHandler"><a href="#自定义TypeHandler" class="headerlink" title="自定义TypeHandler"></a>自定义TypeHandler</h1><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MappedJdbcTypes</span>(JdbcType.VARCHAR)  </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 此处如果不用注解指定jdbcType, 那么，就可以在配置文件中通过"jdbcType"属性指定，</span></span><br><span class="line"><span class="comment">* 同理， javaType 也可通过 <span class="doctag">@MappedTypes</span>指定</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleTypeHandler</span> <span class="keyword">extends</span> <span class="title">BaseTypeHandler</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> setNonNullParameter(PreparedStatement ps</span><br><span class="line">, <span class="keyword">int</span> i</span><br><span class="line">, String parameter</span><br><span class="line">, JdbcType jdbcType) <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    ps.setString(i, parameter);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String getNullableResult(ResultSet rs</span><br><span class="line">, String columnName) <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="function"><span class="keyword">return</span> rs.<span class="title">getString</span><span class="params">(columnName)</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function">String <span class="title">getNullableResult</span><span class="params">(ResultSet rs, <span class="keyword">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">return</span> rs.<span class="title">getString</span><span class="params">(columnIndex)</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String getNullableResult(CallableStatement cs, <span class="keyword">int</span> columnIndex) </span><br><span class="line"><span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="function"><span class="keyword">return</span> cs.<span class="title">getString</span><span class="params">(columnIndex)</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后，就该配置我们的自定义TypeHandler了：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">由于自定义的TypeHandler在定义时已经通过注解指定了jdbcType, 所以此处不用再配置jdbcType</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">"ExampleTypeHandler"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  ......</span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>也就是说，我们在自定义TypeHandler的时候，可以在TypeHandler通过@MappedJdbcTypes指定jdbcType, 通过 @MappedTypes 指定javaType, 如果没有使用注解指定，那么我们就需要在配置文件中配置。</p><p>好啦，本篇文章到此结束。</p><hr>]]></content:encoded>
      
      
    </item>
    
    <item>
      <title>深入浅出Mybatis系列六-objectFactory、plugins、mappers简介与配置</title>
      <link>https://chloneda.github.io//blog/mybatis-6/</link>
      <guid>https://chloneda.github.io//blog/mybatis-6/</guid>
      <pubDate>Sun, 19 May 2019 14:53:29 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;注：本文转载自&lt;a href=&quot;https://www.cnblogs.com/dongying/p/4046488.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;南轲梦&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;上篇文章《深入浅出Mybatis系列（五）—Type
        
      
      </description>
      
      <content:encoded><![CDATA[<p>注：本文转载自<a href="https://www.cnblogs.com/dongying/p/4046488.html" target="_blank" rel="noopener">南轲梦</a></p><p>上篇文章《深入浅出Mybatis系列（五）—TypeHandler简介及配置（mybatis源码篇）》简单看了一下TypeHandler， 本次将结束对于mybatis的配置文件的学习， 本次涉及到剩下没提及到的几个节点的配置：objectFactory、databaseIdProvider、plugins、mappers。</p><p>那么，接下来，就简单介绍一下这几个配置的作用吧：</p><p>1、objectFactory是干什么的？ 需要配置吗？</p><p>MyBatis 每次创建结果对象的新实例时，它都会使用一个对象工厂（ObjectFactory）实例来完成。默认的对象工厂需要做的仅仅是实例化目标类，要么通过默认构造方法，要么在参数映射存在的时候通过参数构造方法来实例化。默认情况下，我们不需要配置，mybatis会调用默认实现的objectFactory。 除非我们要自定义ObjectFactory的实现， 那么我们才需要去手动配置。</p><p>那么怎么自定义实现ObjectFactory？ 怎么配置呢？</p><p>自定义ObjectFactory只需要去继承DefaultObjectFactory（是ObjectFactory接口的实现类），并重写其方法即可。具体的，本处不多说，后面再具体讲解。</p><p>写好了ObjectFactory, 仅需做如下配置：<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">    <span class="params">...</span><span class="params">...</span></span><br><span class="line">    &lt;objectFactory <span class="keyword">type</span>=<span class="string">"org.mybatis.example.ExampleObjectFactory"</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">"someProperty"</span> value=<span class="string">"100"</span>/&gt;</span><br><span class="line">    &lt;/objectFactory&gt;</span><br><span class="line">    <span class="params">...</span><span class="params">...</span></span><br><span class="line">  &lt;/configuration</span><br></pre></td></tr></table></figure></p><p>plugin有何作用？ 需要配置吗？</p><p>plugins 是一个可选配置。mybatis中的plugin其实就是个interceptor， 它可以拦截Executor 、ParameterHandler 、ResultSetHandler 、StatementHandler 的部分方法，处理我们自己的逻辑。Executor就是真正执行sql语句的东西， ParameterHandler 是处理我们传入参数的，还记得前面讲TypeHandler的时候提到过，mybatis默认帮我们实现了不少的typeHandler, 当我们不显示配置typeHandler的时候，mybatis会根据参数类型自动选择合适的typeHandler执行，其实就是ParameterHandler 在选择。ResultSetHandler 就是处理返回结果的。</p><p>怎么自定义plugin? 怎么配置？</p><p>要自定义一个plugin, 需要去实现Interceptor接口， 这儿不细说， 后面实战部分会详细讲解。定义好之后，配置如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    ......</span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">"org.mybatis.example.ExamplePlugin"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"someProperty"</span> <span class="attr">value</span>=<span class="string">"100"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    ......</span><br><span class="line">  <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>mappers, 这下引出mybatis的核心之一了，mappers作用 ? 需要配置吗？</p><p>mappers 节点下，配置我们的mapper映射文件， 所谓的mapper映射文件，就是让mybatis 用来建立数据表和javabean映射的一个桥梁。在我们实际开发中，通常一个mapper文件对应一个dao接口， 这个mapper可以看做是dao的实现。所以,mappers必须配置。</p><p>那么怎么配置呢？<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    ......</span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 第一种方式：通过resource指定 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"com/dy/dao/userDao.xml"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">     <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">第二种方式， 通过class指定接口，进而将接口与对应的xml文件形成映射关系</span></span><br><span class="line"><span class="comment">不过，使用这种方式必须保证 接口与mapper文件同名(不区分大小写)， </span></span><br><span class="line"><span class="comment">我这儿接口是UserDao,那么意味着mapper文件为UserDao.xml </span></span><br><span class="line"><span class="comment">&lt;mapper class="com.dy.dao.UserDao"/&gt;</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">      </span><br><span class="line">     <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">第三种方式，直接指定包，自动扫描，与方法二同理 </span></span><br><span class="line"><span class="comment">&lt;package name="com.dy.dao"/&gt;</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">第四种方式：通过url指定mapper文件位置</span></span><br><span class="line"><span class="comment">&lt;mapper url="file://........"/&gt;</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line">    ......</span><br><span class="line">  <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>本篇仅作简单介绍， 更高级的使用以及其实现原理，会在后面的实战部分进行详细讲解。</p><p>这几个节点的解析源码，与之前提到的那些节点的解析类似，源码需要的可以从这里看看。</p><h1 id="相关节点源码"><a href="#相关节点源码" class="headerlink" title="相关节点源码"></a>相关节点源码</h1><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * objectFactory 节点解析</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="literal">void</span> objectFactoryElement(XNode context) throws Exception &#123;</span><br><span class="line">    <span class="keyword">if</span> (context != <span class="built_in">null</span>) &#123;</span><br><span class="line">      <span class="comment">//读取type属性的值， 接下来进行实例化ObjectFactory, 并set进 configuration</span></span><br><span class="line">      <span class="comment">//到此，简单讲一下configuration这个对象，其实它里面主要保存的都是mybatis的配置</span></span><br><span class="line">      <span class="built_in">String</span> <span class="keyword">type</span> = context.getStringAttribute(<span class="string">"type"</span>);</span><br><span class="line">      <span class="comment">//读取propertie的值， 根据需要可以配置， mybatis默认实现的objectFactory没有使用properties</span></span><br><span class="line">      Properties properties = context.getChildrenAsProperties();</span><br><span class="line">      </span><br><span class="line">      ObjectFactory factory = (ObjectFactory) resolveClass(<span class="keyword">type</span>).newInstance();</span><br><span class="line">      factory.setProperties(properties);</span><br><span class="line">      configuration.setObjectFactory(factory);</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * plugins 节点解析</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="literal">void</span> pluginElement(XNode <span class="keyword">parent</span>) throws Exception &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">parent</span> != <span class="built_in">null</span>) &#123;</span><br><span class="line">      for (XNode child : <span class="keyword">parent</span>.getChildren()) &#123;</span><br><span class="line">        <span class="built_in">String</span> interceptor = child.getStringAttribute(<span class="string">"interceptor"</span>);</span><br><span class="line">        Properties properties = child.getChildrenAsProperties();</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * 由此可见，我们在定义一个interceptor的时候，需要去实现Interceptor, </span></span><br><span class="line"><span class="comment">        * 这儿先不具体讲，以后会详细讲解</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        Interceptor interceptorInstance </span><br><span class="line">= (Interceptor) resolveClass(interceptor).newInstance();</span><br><span class="line">        interceptorInstance.setProperties(properties);</span><br><span class="line">        configuration.addInterceptor(interceptorInstance);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * mappers 节点解析</span></span><br><span class="line"><span class="comment">   * 这是mybatis的核心之一，这儿先简单介绍，在接下来的文章会对它进行分析</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="literal">void</span> mapperElement(XNode <span class="keyword">parent</span>) throws Exception &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">parent</span> != <span class="built_in">null</span>) &#123;</span><br><span class="line">      for (XNode child : <span class="keyword">parent</span>.getChildren()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"package"</span>.<span class="keyword">equals</span>(child.getName())) &#123;</span><br><span class="line">          <span class="comment">//如果mappers节点的子节点是package, 那么就扫描package下的文件, 注入进configuration</span></span><br><span class="line">          <span class="built_in">String</span> mapperPackage = child.getStringAttribute(<span class="string">"name"</span>);</span><br><span class="line">          configuration.addMappers(mapperPackage);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">String</span> resource = child.getStringAttribute(<span class="string">"resource"</span>);</span><br><span class="line">          <span class="built_in">String</span> url = child.getStringAttribute(<span class="string">"url"</span>);</span><br><span class="line">          <span class="built_in">String</span> mapperClass = child.getStringAttribute(<span class="string">"class"</span>);</span><br><span class="line">          <span class="comment">//resource, url, class 三选一</span></span><br><span class="line">          </span><br><span class="line">          <span class="keyword">if</span> (resource != <span class="built_in">null</span> &amp;&amp; url == <span class="built_in">null</span> &amp;&amp; mapperClass == <span class="built_in">null</span>) &#123;</span><br><span class="line">            ErrorContext.instance().resource(resource);</span><br><span class="line">            InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">            <span class="comment">//mapper映射文件都是通过XMLMapperBuilder解析</span></span><br><span class="line">            XMLMapperBuilder mapperParser = <span class="literal">new</span> XMLMapperBuilder(inputStream</span><br><span class="line">, configuration</span><br><span class="line">, resource</span><br><span class="line">, configuration.getSqlFragments());</span><br><span class="line">            mapperParser.parse();</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (resource == <span class="built_in">null</span> &amp;&amp; url != <span class="built_in">null</span> &amp;&amp; mapperClass == <span class="built_in">null</span>) &#123;</span><br><span class="line">            ErrorContext.instance().resource(url);</span><br><span class="line">            InputStream inputStream = Resources.getUrlAsStream(url);</span><br><span class="line">            XMLMapperBuilder mapperParser = <span class="literal">new</span> XMLMapperBuilder(inputStream</span><br><span class="line">, configuration</span><br><span class="line">, url</span><br><span class="line">, configuration.getSqlFragments());</span><br><span class="line">            mapperParser.parse();</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (resource == <span class="built_in">null</span> &amp;&amp; url == <span class="built_in">null</span> &amp;&amp; mapperClass != <span class="built_in">null</span>) &#123;</span><br><span class="line">            Class&lt;<span class="meta">?&gt;</span> mapperInterface = Resources.classForName(mapperClass);</span><br><span class="line">            configuration.addMapper(mapperInterface);</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            throw new BuilderException("A mapper element may only specify a url</span><br><span class="line">, resource or class, but not more than one.");</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>本次就简单的到此结束， 从下篇文章开始，将会开始接触到mybatis的核心部分，不过首先还是要讲mapper文件的配置及使用， 并通过源码进一步深入核心。</p><hr>]]></content:encoded>
      
      
    </item>
    
    <item>
      <title>深入浅出Mybatis系列八-mapper映射文件配置之select、resultMap</title>
      <link>https://chloneda.github.io//blog/mybatis-8/</link>
      <guid>https://chloneda.github.io//blog/mybatis-8/</guid>
      <pubDate>Sun, 19 May 2019 14:53:29 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;注：本文转载自&lt;a href=&quot;https://www.cnblogs.com/dongying/p/4073259.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;南轲梦&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;上篇《深入浅出Mybatis系列（七）—mapper
        
      
      </description>
      
      <content:encoded><![CDATA[<p>注：本文转载自<a href="https://www.cnblogs.com/dongying/p/4073259.html" target="_blank" rel="noopener">南轲梦</a></p><p>上篇《深入浅出Mybatis系列（七）—mapper映射文件配置之insert、update、delete》介绍了insert、update、delete的用法，本篇将介绍select、resultMap的用法。select无疑是我们最常用，也是最复杂的，mybatis通过resultMap能帮助我们很好地进行高级映射。下面就开始看看select 以及 resultMap的用法：</p><p>先看select的配置吧：</p><h1 id="select配置"><a href="#select配置" class="headerlink" title="select配置"></a>select配置</h1><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">select</span></span></span></span><br><span class="line"><span class="xml">     <span class="comment">&lt;!--  </span></span></span><br><span class="line"><span class="xml">1. id （必须配置）</span></span><br><span class="line"><span class="xml">        id是命名空间中的唯一标识符，可被用来代表这条语句。 </span></span><br><span class="line"><span class="xml">        一个命名空间（namespace） 对应一个dao接口, </span></span><br><span class="line"><span class="xml">        这个id也应该对应dao里面的某个方法（相当于方法的实现），因此id 应该与方法名一致  </span></span><br><span class="line"><span class="xml">　　　--&gt;</span></span><br><span class="line"><span class="xml">     </span></span><br><span class="line"><span class="xml">     id="selectPerson"</span></span><br><span class="line"><span class="xml">     </span></span><br><span class="line"><span class="xml">     <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">2. parameterType （可选配置, 默认为mybatis自动选择处理）</span></span><br><span class="line"><span class="xml">        将要传入语句的参数的完全限定类名或别名， 如果不配置，mybatis会通过ParameterHandler </span></span><br><span class="line"><span class="xml">根据参数类型默认选择合适的typeHandler进行处理</span></span><br><span class="line"><span class="xml">        parameterType 主要指定参数类型，可以是int, short, long, </span></span><br><span class="line"><span class="xml">string等类型，也可以是复杂类型（如对象） </span></span><br><span class="line"><span class="xml">　　　--&gt;</span></span><br><span class="line"><span class="xml">     parameterType="int"</span></span><br><span class="line"><span class="xml">     </span></span><br><span class="line"><span class="xml">     <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">3. resultType (resultType 与 resultMap 二选一配置)</span></span><br><span class="line"><span class="xml">        resultType用以指定返回类型，指定的类型可以是基本类型，可以是java容器，也可以是javabean </span></span><br><span class="line"><span class="xml">     --&gt;</span></span><br><span class="line"><span class="xml">     resultType="hashmap"</span></span><br><span class="line"><span class="xml">     </span></span><br><span class="line"><span class="xml">     <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">4. resultMap (resultType 与 resultMap 二选一配置)</span></span><br><span class="line"><span class="xml">        resultMap用于引用我们通过 resultMap标签定义的映射类型，</span></span><br><span class="line"><span class="xml">这也是mybatis组件高级复杂映射的关键 </span></span><br><span class="line"><span class="xml">     --&gt;</span></span><br><span class="line"><span class="xml">     resultMap="personResultMap"</span></span><br><span class="line"><span class="xml">     </span></span><br><span class="line"><span class="xml">     <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">5. flushCache (可选配置)</span></span><br><span class="line"><span class="xml">        将其设置为 true，任何时候只要语句被调用，都会导致本地缓存和二级缓存都会被清空，默认值：false </span></span><br><span class="line"><span class="xml">     --&gt;</span></span><br><span class="line"><span class="xml">     flushCache="false"</span></span><br><span class="line"><span class="xml">     </span></span><br><span class="line"><span class="xml">     <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">6. useCache (可选配置)</span></span><br><span class="line"><span class="xml">        将其设置为 true，将会导致本条语句的结果被二级缓存，默认值：对 select 元素为 true </span></span><br><span class="line"><span class="xml">     --&gt;</span></span><br><span class="line"><span class="xml">     useCache="true"</span></span><br><span class="line"><span class="xml">     </span></span><br><span class="line"><span class="xml">     <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">7. timeout (可选配置) </span></span><br><span class="line"><span class="xml">        这个设置是在抛出异常之前，驱动程序等待数据库返回请求结果的秒数。默认值为 unset（依赖驱动）</span></span><br><span class="line"><span class="xml">     --&gt;</span></span><br><span class="line"><span class="xml">     timeout="10000"</span></span><br><span class="line"><span class="xml">     </span></span><br><span class="line"><span class="xml">     <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">8. fetchSize (可选配置) </span></span><br><span class="line"><span class="xml">        这是尝试影响驱动程序每次批量返回的结果行数和这个设置值相等。默认值为 unset（依赖驱动)</span></span><br><span class="line"><span class="xml">     --&gt;</span></span><br><span class="line"><span class="xml">     fetchSize="256"</span></span><br><span class="line"><span class="xml">     </span></span><br><span class="line"><span class="xml">     <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">9. statementType (可选配置) </span></span><br><span class="line"><span class="xml">        STATEMENT，PREPARED 或 CALLABLE 的一个。这会让 MyBatis 分别使用</span></span><br><span class="line"><span class="xml">Statement，PreparedStatement 或 CallableStatement，默认值：PREPARED</span></span><br><span class="line"><span class="xml">     --&gt;</span></span><br><span class="line"><span class="xml">     statementType="PREPARED"</span></span><br><span class="line"><span class="xml">     </span></span><br><span class="line"><span class="xml">     <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">10. resultSetType (可选配置) </span></span><br><span class="line"><span class="xml">        FORWARD_ONLY，SCROLL_SENSITIVE 或 SCROLL_INSENSITIVE 中的一个，</span></span><br><span class="line"><span class="xml">默认值为 unset （依赖驱动）</span></span><br><span class="line"><span class="xml">     --&gt;</span></span><br><span class="line"><span class="xml">     resultSetType="FORWARD_ONLY"&gt;</span></span><br></pre></td></tr></table></figure><p>配置看起来总是这么多，不过实际常用的配置也就那么几个， 根据自己的需要吧，上面都已注明是否必须配置。</p><p>下面还是上个demo及时练练手吧!</p><p>数据库：新增两张表（t_course, t_student）,以下为相关实体类。</p><h1 id="Course-java"><a href="#Course-java" class="headerlink" title="Course.java"></a>Course.java</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Course</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> deleteFlag;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//setter和getter方法省略...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Student-java"><a href="#Student-java" class="headerlink" title="Student.java"></a>Student.java</h1><figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String idCard;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">List</span>&lt;Course&gt; courseList;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> deleteFlag;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//setter和getter方法省略...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="CourseDao-java"><a href="#CourseDao-java" class="headerlink" title="CourseDao.java"></a>CourseDao.java</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public<span class="built_in"> interface </span>CourseDao &#123;</span><br><span class="line">    public Course findCourseById(int courseId); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="StudentDao-java"><a href="#StudentDao-java" class="headerlink" title="StudentDao.java"></a>StudentDao.java</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public<span class="built_in"> interface </span>StudentDao &#123;</span><br><span class="line">    public Student findStudentById(String idCard);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="courseDao-xml"><a href="#courseDao-xml" class="headerlink" title="courseDao.xml"></a>courseDao.xml</h1><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;mapper namespace=<span class="string">"com.dy.dao.CourseDao"</span>&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!<span class="comment">-- </span></span><br><span class="line">         <span class="number">1.</span>此处直接将resultType 设置为course, 一看就知道我设置了别名吧，</span><br><span class="line">   如果没有设置别名，那么resultType = com.dy.entity.Course。</span><br><span class="line">         <span class="number">2.</span>可能细心的你会发现：Course.java中的属性名与数据库字段名不一致，下面，</span><br><span class="line">           我就在sql语句中用了<span class="keyword">as</span>, 使之匹配，当然方法不止一种，在学习了resultMap之后，</span><br><span class="line">           你能看到一种更直观优雅的方式去将javabean中的属性与数据库字段名保持一致</span><br><span class="line">         <span class="number">3.</span>findCourseById 与CourseDao中findCourseById方法对应， </span><br><span class="line">           那么传入的参数名称以及类型也应该保持对应关系。</span><br><span class="line">         <span class="number">4.</span>可以看到，在sql语句中，通过<span class="comment">#&#123;&#125;表达式可以获取参数。</span></span><br><span class="line">         <span class="number">5.</span>下面这条sql语句，实际上的形式是怎么样的？还记得之前说过，</span><br><span class="line">           mybatis默认为preparedStatement吧，那么，用我们jdbc代码来看，它其实就是：</span><br><span class="line">           select course_id <span class="keyword">as</span> <span class="built_in">id</span>, course_name <span class="keyword">as</span> <span class="built_in">name</span>, course_delete_flg <span class="keyword">as</span> deleteFlag </span><br><span class="line">                <span class="keyword">from</span> t_course <span class="keyword">where</span> course_id=?</span><br><span class="line">     <span class="comment">--&gt;</span></span><br><span class="line">    &lt;select <span class="built_in">id</span>=<span class="string">"findCourseById"</span>  resultType=<span class="string">"course"</span> &gt;</span><br><span class="line">        select course_id <span class="keyword">as</span> <span class="built_in">id</span></span><br><span class="line">, course_name <span class="keyword">as</span> <span class="built_in">name</span></span><br><span class="line">, course_delete_flg <span class="keyword">as</span> deleteFlag </span><br><span class="line">  <span class="keyword">from</span> t_course </span><br><span class="line">  <span class="keyword">where</span> course_id=<span class="comment">#&#123;courseId&#125;</span></span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure><h1 id="CourseDaoTest-java"><a href="#CourseDaoTest-java" class="headerlink" title="CourseDaoTest.java"></a>CourseDaoTest.java</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseDaoTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findCourseById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = getSessionFactory();</span><br><span class="line">        SqlSession sqlSession = sqlSessionFactory.openSession(); </span><br><span class="line">        CourseDao courseDao = sqlSession.getMapper(CourseDao.class);</span><br><span class="line">        Course course = courseDao.findCourseById(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Mybatis 通过SqlSessionFactory获取SqlSession, 然后才能通过SqlSession与数据库进行交互</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory <span class="title">getSessionFactory</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        SqlSessionFactory sessionFactory = <span class="keyword">null</span>;  </span><br><span class="line">        String resource = <span class="string">"mybatis-conf.xml"</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            sessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(Resources  </span><br><span class="line">                    .getResourceAsReader(resource));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> sessionFactory;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的示例，我们针对course, 简单演示了 select的用法， 不过有个问题值得思考： 一个student可以对应多个course,  那么，在mybatis中如何处理这种一对多， 甚至于多对多，一对一的关系呢？</p><p>这儿，就不得不提到 resultMap 这个东西， mybatis的resultMap功能可谓十分强大，能够处理复杂的关系映射， 那么resultMap 该怎么配置呢？ 别急，这就来了：</p><h1 id="resultMap配置"><a href="#resultMap配置" class="headerlink" title="resultMap配置"></a>resultMap配置</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">        1.type 对应类型，可以是javabean, 也可以是其它</span></span><br><span class="line"><span class="comment">        2.id 必须唯一， 用于标示这个resultMap的唯一性，在使用resultMap的时候，就是通过id指定</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    id, 唯一性，注意啦，这个id用于标示这个javabean对象的唯一性， </span></span><br><span class="line"><span class="comment">            不一定会是数据库的主键（不要把它理解为数据库对应表的主键） </span></span><br><span class="line"><span class="comment">            property属性对应javabean的属性名，column对应数据库表的列名</span></span><br><span class="line"><span class="comment">           （这样，当javabean的属性与数据库对应表的列名不一致的时候，就能通过指定这个保持正常映射了）</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">""</span> <span class="attr">column</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- result与id相比， 对应普通属性 --&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">""</span> <span class="attr">column</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">            constructor对应javabean中的构造方法</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- idArg 对应构造方法中的id参数 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">idArg</span> <span class="attr">column</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- arg 对应构造方法中的普通参数 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">arg</span> <span class="attr">column</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">constructor</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">            collection，对应javabean中容器类型, 是实现一对多的关键 </span></span><br><span class="line"><span class="comment">            property 为javabean中容器对应字段名</span></span><br><span class="line"><span class="comment">            column 为体现在数据库中列名</span></span><br><span class="line"><span class="comment">            ofType 就是指定javabean中容器指定的类型</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">""</span> <span class="attr">column</span>=<span class="string">""</span> <span class="attr">ofType</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">            association 为关联关系，是实现N对一的关键。</span></span><br><span class="line"><span class="comment">            property 为javabean中容器对应字段名</span></span><br><span class="line"><span class="comment">            column 为体现在数据库中列名</span></span><br><span class="line"><span class="comment">            javaType 指定关联的类型</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">""</span> <span class="attr">column</span>=<span class="string">""</span> <span class="attr">javaType</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p>好啦，知道resutMap怎么配置后，咱们立即接着上面的demo来练习一下吧：</p><p><strong>下面是用resultMap处理一对多关系的映射的示例</strong></p><p>一个student对应多个course， 典型的一对多，咱们就来看看mybatis怎么配置这种映射吧：</p><h1 id="studentDao-xml"><a href="#studentDao-xml" class="headerlink" title="studentDao.xml"></a>studentDao.xml</h1><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.dy.dao.StudentDao"</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 这儿定义一个resultMap --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"student"</span> <span class="attr">id</span>=<span class="string">"studentMap"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span></span><br><span class="line"><span class="xml">        <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">            数据库中主键是id, 但是我这儿却是指定idCard为主键，为什么？ </span></span><br><span class="line"><span class="xml">            刚刚讲了，id用来表示唯一性， 我们可以认为只要idCard一样，那么他就是同一个学生。</span></span><br><span class="line"><span class="xml">            如果此处用数据库中id， 那么mybatis将会认为数据库中每条记录都是一个student, </span></span><br><span class="line"><span class="xml">            这显然不符合逻辑</span></span><br><span class="line"><span class="xml">        --&gt;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"idCard"</span> <span class="attr">column</span>=<span class="string">"stu_id_card"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"stu_id"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"stu_name"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"deleteFlag"</span> <span class="attr">column</span>=<span class="string">"stu_delete_flg"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">        </span></span><br><span class="line"><span class="xml">        <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">            这儿就是实现一对多的关键。 </span></span><br><span class="line"><span class="xml">            在Student中，courseList为List<span class="tag">&lt;<span class="name">Course</span>&gt;</span>, 因此，</span></span><br><span class="line"><span class="xml">            ofType也应该与之对应（当然，我用了别名，不然要蛋疼的写全名了）。</span></span><br><span class="line"><span class="xml">            collection的子标签是在指定Course的映射关系</span></span><br><span class="line"><span class="xml">            （由于Course的javabean的属性名与数据库的列名不一致）</span></span><br><span class="line"><span class="xml">        --&gt;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"courseList"</span> <span class="attr">column</span>=<span class="string">"stu_course_id"</span> <span class="attr">ofType</span>=<span class="string">"Course"</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"course_id"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"course_name"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"deleteFlag"</span> <span class="attr">column</span>=<span class="string">"course_delete_flg"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 这儿将返回类型设置成了上面指定的studentMap --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findStudentById"</span> <span class="attr">resultMap</span>=<span class="string">"studentMap"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        SELECT s.*, </span></span><br><span class="line"><span class="xml">       c.* </span></span><br><span class="line"><span class="xml">  FROM t_student s </span></span><br><span class="line"><span class="xml">LEFT JOIN t_course c </span></span><br><span class="line"><span class="xml">ON s.stu_course_id=c.course_id </span></span><br><span class="line"><span class="xml">  WHERE s.stu_id_card=#</span><span class="template-variable">&#123;idCard&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h1 id="StudentDaoTest-java"><a href="#StudentDaoTest-java" class="headerlink" title="StudentDaoTest.java"></a>StudentDaoTest.java</h1><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">StudentDaoTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findCourseById</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = getSessionFactory();</span><br><span class="line">        SqlSession sqlSession = sqlSessionFactory.openSession(); </span><br><span class="line">        StudentDao studentDao = sqlSession.getMapper(StudentDao.class);</span><br><span class="line">        Student student = studentDao.findStudentById(<span class="string">"20140101"</span>);</span><br><span class="line">        List&lt;Course&gt; courseList = student.getCourseList();</span><br><span class="line">        <span class="keyword">for</span> (Course course: courseList) &#123;</span><br><span class="line">            System.<span class="keyword">out</span>.println(course.getId() + <span class="string">"   "</span> + course.getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Mybatis 通过SqlSessionFactory获取SqlSession, 然后才能通过SqlSession与数据库进行交互</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory <span class="title">getSessionFactory</span>(<span class="params"></span>)</span> &#123;  </span><br><span class="line">        SqlSessionFactory sessionFactory = <span class="literal">null</span>;  </span><br><span class="line">        String resource = <span class="string">"mybatis-conf.xml"</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            sessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(Resources  </span><br><span class="line">                    .getResourceAsReader(resource));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> sessionFactory;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>相信通过以上demo， 大家也能够使用mybatis的select 和 resultMap的用法了。上面demo只演示了一对多的映射，其实多对一、多对多也与它类似，所以我就没演示了，有兴趣的可以自己动手再做做。</p><hr>]]></content:encoded>
      
      
    </item>
    
    <item>
      <title>深入浅出Mybatis系列九-强大的动态SQL</title>
      <link>https://chloneda.github.io//blog/mybatis-9/</link>
      <guid>https://chloneda.github.io//blog/mybatis-9/</guid>
      <pubDate>Sun, 19 May 2019 14:53:29 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;注：本文转载自&lt;a href=&quot;https://www.cnblogs.com/dongying/p/4092662.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;南轲梦&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;上篇文章《深入浅出Mybatis系列（八）—mapp
        
      
      </description>
      
      <content:encoded><![CDATA[<p>注：本文转载自<a href="https://www.cnblogs.com/dongying/p/4092662.html" target="_blank" rel="noopener">南轲梦</a></p><p>上篇文章《深入浅出Mybatis系列（八）—mapper映射文件配置之select、resultMap》简单介绍了mybatis的查询，至此，CRUD都已讲完。本文将介绍mybatis强大的动态SQL。</p><p>那么，问题来了： 什么是动态SQL? 动态SQL有什么作用？</p><p>传统的使用JDBC的方法，相信大家在组合复杂的的SQL语句的时候，需要去拼接，稍不注意哪怕少了个空格，都会导致错误。Mybatis的动态SQL功能正是为了解决这种问题， 其通过 if, choose, when, otherwise, trim, where, set, foreach标签，可组合成非常灵活的SQL语句，从而提高开发人员的效率。下面就去感受Mybatis动态SQL的魅力吧：</p><h1 id="mybatis中if判断"><a href="#mybatis中if判断" class="headerlink" title="mybatis中if判断"></a>mybatis中if判断</h1><p>作为程序猿，谁不懂if　!在mybatis中也能用 if 啦：<br><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">select</span> id=<span class="string">"findUserById"</span> resultType=<span class="string">"user"</span>&gt;</span><br><span class="line">           <span class="keyword">select</span> * <span class="keyword">from</span> user <span class="keyword">where</span> </span><br><span class="line">           &lt;<span class="keyword">if</span> test=<span class="string">"id != null"</span>&gt;</span><br><span class="line">               id=<span class="meta">#&#123;id&#125;</span></span><br><span class="line">           &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            <span class="keyword">and</span> deleteFlag=<span class="number">0</span>;</span><br><span class="line">&lt;/<span class="keyword">select</span>&gt;</span><br></pre></td></tr></table></figure></p><p>上面例子： 如果传入的id 不为空， 那么才会SQL才拼接id = #{id}。 这个相信大家看一样就能明白，不多说。</p><p>细心的人会发现一个问题：“你这不对啊！ 要是你传入的id为null,  那么你这最终的SQL语句不就成了 select * from user where and deleteFlag=0,  这语句有问题！”</p><p>是啊，这时候，mybatis的 where 标签就该隆重登场啦：</p><h1 id="mybatis中where"><a href="#mybatis中where" class="headerlink" title="mybatis中where"></a>mybatis中where</h1><p>咱们通过where改造一下上面的例子：<br><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">select</span> id=<span class="string">"findUserById"</span> resultType=<span class="string">"user"</span>&gt;</span><br><span class="line">           <span class="keyword">select</span> * <span class="keyword">from</span> user </span><br><span class="line">           &lt;<span class="keyword">where</span>&gt;</span><br><span class="line">               &lt;<span class="keyword">if</span> test=<span class="string">"id != null"</span>&gt;</span><br><span class="line">                   id=<span class="meta">#&#123;id&#125;</span></span><br><span class="line">               &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">               <span class="keyword">and</span> deleteFlag=<span class="number">0</span>;</span><br><span class="line">           &lt;/<span class="keyword">where</span>&gt;</span><br><span class="line"> &lt;/<span class="keyword">select</span>&gt;</span><br></pre></td></tr></table></figure></p><p>有些人就要问了： “你这都是些什么玩意儿！ 跟上面的相比， 不就是多了个where标签嘛！ 那这个还会不会出现  select * from user where and deleteFlag=0 ？”</p><p>的确，从表面上来看，就是多了个where标签而已， 不过实质上， mybatis是对它做了处理，当它遇到AND或者OR这些，它知道怎么处理。其实我们可以通过 trim 标签去自定义这种处理规则。</p><h1 id="trim-我的地盘，我做主"><a href="#trim-我的地盘，我做主" class="headerlink" title="trim:我的地盘，我做主"></a>trim:我的地盘，我做主</h1><p>上面的where标签，其实用trim 可以表示如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"WHERE"</span> <span class="attr">prefixOverrides</span>=<span class="string">"AND |OR "</span>&gt;</span></span><br><span class="line">  ... </span><br><span class="line"><span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>它的意思就是： 当WHERE后紧随AND或则OR的时候，就去除AND或者OR。 除了WHERE以外， 其实还有一个比较经典的实现，那就是SET。</p><h1 id="set-信我，不出错"><a href="#set-信我，不出错" class="headerlink" title="set: 信我，不出错"></a>set: 信我，不出错</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;update id=<span class="string">"updateUser"</span> parameterType=<span class="string">"com.dy.entity.User"</span>&gt;</span><br><span class="line">           update user <span class="built_in">set</span> </span><br><span class="line">           &lt;<span class="keyword">if</span> <span class="built_in">test</span>=<span class="string">"name != null"</span>&gt;</span><br><span class="line">               name = <span class="comment">#&#123;name&#125;,</span></span><br><span class="line">           &lt;/<span class="keyword">if</span>&gt; </span><br><span class="line">           &lt;<span class="keyword">if</span> <span class="built_in">test</span>=<span class="string">"password != null"</span>&gt;</span><br><span class="line">               password = <span class="comment">#&#123;password&#125;,</span></span><br><span class="line">           &lt;/<span class="keyword">if</span>&gt; </span><br><span class="line">           &lt;<span class="keyword">if</span> <span class="built_in">test</span>=<span class="string">"age != null"</span>&gt;</span><br><span class="line">               age = <span class="comment">#&#123;age&#125;</span></span><br><span class="line">           &lt;/<span class="keyword">if</span>&gt; </span><br><span class="line">           &lt;<span class="built_in">where</span>&gt;</span><br><span class="line">               &lt;<span class="keyword">if</span> <span class="built_in">test</span>=<span class="string">"id != null"</span>&gt;</span><br><span class="line">                   id = <span class="comment">#&#123;id&#125;</span></span><br><span class="line">               &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">               and deleteFlag = 0;</span><br><span class="line">           &lt;/<span class="built_in">where</span>&gt;</span><br><span class="line">&lt;/update&gt;</span><br></pre></td></tr></table></figure><p>问题又来了： “如果我只有name不为null,  那么这SQL不就成了 update set name = #{name}, where …….. ?  你那name后面那逗号会导致出错啊！”</p><p>是的，这时候，就可以用mybatis为我们提供的set 标签了。下面是通过set标签改造后：<br><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateUser"</span> <span class="attr">parameterType</span>=<span class="string">"com.dy.entity.User"</span>&gt;</span></span></span><br><span class="line"><span class="xml">           update user</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"name != null"</span>&gt;</span>name = #</span><span class="template-variable">&#123;name&#125;</span><span class="xml">,<span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span></span><br><span class="line"><span class="xml">             <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"password != null"</span>&gt;</span>password = #</span><span class="template-variable">&#123;password&#125;</span><span class="xml">,<span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span></span><br><span class="line"><span class="xml">             <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"age != null"</span>&gt;</span>age = #</span><span class="template-variable">&#123;age&#125;</span><span class="xml">,<span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span></span><br><span class="line"><span class="xml">             <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"id != null"</span>&gt;</span></span></span><br><span class="line"><span class="xml">                   id = #</span><span class="template-variable">&#123;id&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">             <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="xml">                and deleteFlag = 0;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p><p>这个用trim 可表示为：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"SET"</span> <span class="attr">suffixOverrides</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h1 id="foreach-你有for-我有foreach！"><a href="#foreach-你有for-我有foreach！" class="headerlink" title="foreach:  你有for, 我有foreach！"></a>foreach:  你有for, 我有foreach！</h1><p>java中有for, 可通过for循环， 同样， mybatis中有foreach, 可通过它实现循环，循环的对象当然主要是java容器和数组。<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">select</span> id=<span class="string">"selectPostIn"</span> resultType=<span class="string">"domain.blog.Post"</span>&gt;</span><br><span class="line">SELECT *</span><br><span class="line">  FROM POST P</span><br><span class="line">  WHERE ID <span class="keyword">in</span></span><br><span class="line">&lt;<span class="built_in">foreach</span> item=<span class="string">"item"</span> index=<span class="string">"index"</span> collection=<span class="string">"list"</span></span><br><span class="line">      <span class="built_in">open</span>=<span class="string">"("</span> separator=<span class="string">","</span> <span class="built_in">close</span>=<span class="string">")"</span>&gt;</span><br><span class="line">#&#123;item&#125;</span><br><span class="line">&lt;/<span class="built_in">foreach</span>&gt;</span><br><span class="line">&lt;/<span class="built_in">select</span>&gt;</span><br></pre></td></tr></table></figure></p><p>将一个 List 实例或者数组作为参数对象传给 MyBatis，当这么做的时候，MyBatis 会自动将它包装在一个 Map 中并以名称为键。List 实例将会以“list”作为键，而数组实例的键将是“array”。同样， 当循环的对象为map的时候，index其实就是map的key。</p><h1 id="choose-我选择了你，你选择了我"><a href="#choose-我选择了你，你选择了我" class="headerlink" title="choose: 我选择了你，你选择了我"></a>choose: 我选择了你，你选择了我</h1><p>Java中有switch,  mybatis有choose<br><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">select</span> id=<span class="string">"findActiveBlogLike"</span> resultType=<span class="string">"Blog"</span>&gt;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> BLOG <span class="keyword">WHERE</span> state = ‘ACTIVE’</span><br><span class="line">&lt;choose&gt;</span><br><span class="line">    &lt;<span class="keyword">when</span> test=<span class="string">"title != null"</span>&gt;</span><br><span class="line">        <span class="keyword">AND</span> title <span class="keyword">like</span> <span class="meta">#&#123;title&#125;</span></span><br><span class="line">    &lt;/<span class="keyword">when</span>&gt;</span><br><span class="line">    &lt;<span class="keyword">when</span> test=<span class="string">"author != null and author.name != null"</span>&gt;</span><br><span class="line">        <span class="keyword">AND</span> author_name <span class="keyword">like</span> <span class="meta">#&#123;author.name&#125;</span></span><br><span class="line">    &lt;/<span class="keyword">when</span>&gt;</span><br><span class="line">    &lt;otherwise&gt;</span><br><span class="line">        <span class="keyword">AND</span> featured = <span class="number">1</span></span><br><span class="line">    &lt;/otherwise&gt;</span><br><span class="line">&lt;/choose&gt;</span><br><span class="line">&lt;/<span class="keyword">select</span>&gt;</span><br></pre></td></tr></table></figure></p><p>以上例子中： 当title和author都不为null的时候， 那么选择二选一（前者优先）， 如果都为null, 那么就选择 otherwise中的， 如果tilte和author只有一个不为null, 那么就选择不为null的那个。</p><p>纵观mybatis的动态SQL， 强大而简单， 相信大家简单看一下就能使用了。</p><p>好啦，本次就写到这！下篇文章将结合mybatis的源码分析一次sql语句执行的整个过程。</p><hr>]]></content:encoded>
      
      
    </item>
    
    <item>
      <title>深入浅出Mybatis系列七-mapper映射文件配置之insert、update、delete</title>
      <link>https://chloneda.github.io//blog/mybatis-7/</link>
      <guid>https://chloneda.github.io//blog/mybatis-7/</guid>
      <pubDate>Sun, 19 May 2019 14:53:29 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;注：本文转载自&lt;a href=&quot;https://www.cnblogs.com/dongying/p/4048828.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;南轲梦&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;上篇文章《深入浅出Mybatis系列（六）—obje
        
      
      </description>
      
      <content:encoded><![CDATA[<p>注：本文转载自<a href="https://www.cnblogs.com/dongying/p/4048828.html" target="_blank" rel="noopener">南轲梦</a></p><p>上篇文章《深入浅出Mybatis系列（六）—objectFactory、plugins、mappers简介与配置》简单地给mybatis的配置画上了一个句号。那么从本篇文章开始，将会介绍mapper映射文件的配置， 这是mybatis的核心之一，一定要学好。在mapper文件中，以mapper作为根节点，其下面可以配置的元素节点有： select, insert, update, delete, cache, cache-ref, resultMap, sql 。</p><p>本篇文章将简单介绍 insert, update, delete 的配置及使用，以后会对mybatis的源码进行深入讲解。</p><p>相信，看到insert, update, delete， 我们就知道其作用了，顾名思义嘛，myabtis 作为持久层框架，必须要对CRUD啊。</p><p>好啦，咱们就先来看看 insert, update, delete 怎么配置， 能配置哪些元素吧：</p><p>相关元素配置<br><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>   </span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE mapper   </span></span></span><br><span class="line"><span class="xml">PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"  </span></span><br><span class="line"><span class="xml">"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd"&gt; </span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- mapper 为根元素节点， 一个namespace对应一个dao --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.dy.dao.UserDao"</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">insert</span></span></span></span><br><span class="line"><span class="xml">      <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">        1. id （必须配置）</span></span><br><span class="line"><span class="xml">        id是命名空间中的唯一标识符，可被用来代表这条语句。 </span></span><br><span class="line"><span class="xml">        一个命名空间（namespace） 对应一个dao接口, </span></span><br><span class="line"><span class="xml">        这个id也应该对应dao里面的某个方法（相当于方法的实现），因此id 应该与方法名一致 </span></span><br><span class="line"><span class="xml">　　　　--&gt;</span></span><br><span class="line"><span class="xml">      </span></span><br><span class="line"><span class="xml">      id="insertUser"</span></span><br><span class="line"><span class="xml">      </span></span><br><span class="line"><span class="xml">      <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">         2. parameterType （可选配置, 默认为mybatis自动选择处理）</span></span><br><span class="line"><span class="xml">         将要传入语句的参数的完全限定类名或别名， 如果不配置，</span></span><br><span class="line"><span class="xml">　　　　　 mybatis会通过ParameterHandler 根据参数类型默认选择合适的typeHandler进行处理</span></span><br><span class="line"><span class="xml">         parameterType 主要指定参数类型，可以是int, short, long, </span></span><br><span class="line"><span class="xml">　　　　　 string等类型，也可以是复杂类型（如对象）</span></span><br><span class="line"><span class="xml">　　　　--&gt;</span></span><br><span class="line"><span class="xml">      </span></span><br><span class="line"><span class="xml">      parameterType="com.demo.User"</span></span><br><span class="line"><span class="xml">      </span></span><br><span class="line"><span class="xml">      <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">         3. flushCache （可选配置，默认配置为true）</span></span><br><span class="line"><span class="xml">         将其设置为 true，任何时候只要语句被调用，都会导致本地缓存和二级缓存都会被清空，</span></span><br><span class="line"><span class="xml">         默认值：true（对应插入、更新和删除语句） </span></span><br><span class="line"><span class="xml">      --&gt;</span></span><br><span class="line"><span class="xml">      </span></span><br><span class="line"><span class="xml">      flushCache="true"</span></span><br><span class="line"><span class="xml">      </span></span><br><span class="line"><span class="xml">      <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">         4. statementType （可选配置，默认配置为PREPARED）</span></span><br><span class="line"><span class="xml">         STATEMENT，PREPARED 或 CALLABLE 的一个。这会让 MyBatis 分别使用 Statement，</span></span><br><span class="line"><span class="xml">         PreparedStatement 或 CallableStatement，默认值：PREPARED。 </span></span><br><span class="line"><span class="xml">      --&gt;</span></span><br><span class="line"><span class="xml">      </span></span><br><span class="line"><span class="xml">      statementType="PREPARED"</span></span><br><span class="line"><span class="xml">      </span></span><br><span class="line"><span class="xml">      <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">         5. keyProperty (可选配置， 默认为unset)</span></span><br><span class="line"><span class="xml">        （仅对 insert 和 update 有用）唯一标记一个属性，MyBatis 会通过 </span></span><br><span class="line"><span class="xml">         getGeneratedKeys 的返回值或者通过 insert 语句的 selectKey 子元素设置它的键值，</span></span><br><span class="line"><span class="xml">         默认：unset。如果希望得到多个生成的列，也可以是逗号分隔的属性名称列表。 </span></span><br><span class="line"><span class="xml">      --&gt;</span></span><br><span class="line"><span class="xml">      </span></span><br><span class="line"><span class="xml">      keyProperty=""</span></span><br><span class="line"><span class="xml">      </span></span><br><span class="line"><span class="xml">      <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">         6. keyColumn     (可选配置)</span></span><br><span class="line"><span class="xml">        （仅对 insert 和 update 有用）通过生成的键值设置表中的列名，这个设置仅在某些数据库</span></span><br><span class="line"><span class="xml">        （像 PostgreSQL）是必须的，当主键列不是表中的第一列的时候需要设置。</span></span><br><span class="line"><span class="xml">         如果希望得到多个生成的列，也可以是逗号分隔的属性名称列表。 </span></span><br><span class="line"><span class="xml">      --&gt;</span></span><br><span class="line"><span class="xml">      </span></span><br><span class="line"><span class="xml">      keyColumn=""</span></span><br><span class="line"><span class="xml">      </span></span><br><span class="line"><span class="xml">      <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">         7. useGeneratedKeys (可选配置， 默认为false)</span></span><br><span class="line"><span class="xml">        （仅对 insert 和 update 有用）这会令 MyBatis 使用 JDBC 的 </span></span><br><span class="line"><span class="xml">         getGeneratedKeys 方法来取出由数据库内部生成的主键（比如：像 MySQL 和 SQL Server </span></span><br><span class="line"><span class="xml">         这样的关系数据库管理系统的自动递增字段），默认值：false。  </span></span><br><span class="line"><span class="xml">      --&gt;</span></span><br><span class="line"><span class="xml">      </span></span><br><span class="line"><span class="xml">      useGeneratedKeys="false"</span></span><br><span class="line"><span class="xml">      </span></span><br><span class="line"><span class="xml">      <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">         8. timeout  (可选配置， 默认为unset, 依赖驱动)</span></span><br><span class="line"><span class="xml">         这个设置是在抛出异常之前，驱动程序等待数据库返回请求结果的秒数。默认值为 unset（依赖驱动）。 </span></span><br><span class="line"><span class="xml">      --&gt;</span></span><br><span class="line"><span class="xml">      timeout="20"&gt;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">update</span></span></span></span><br><span class="line"><span class="xml">      id="updateUser"</span></span><br><span class="line"><span class="xml">      parameterType="com.demo.User"</span></span><br><span class="line"><span class="xml">      flushCache="true"</span></span><br><span class="line"><span class="xml">      statementType="PREPARED"</span></span><br><span class="line"><span class="xml">      timeout="20"&gt;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">delete</span></span></span></span><br><span class="line"><span class="xml">      id="deleteUser"</span></span><br><span class="line"><span class="xml">      parameterType="com.demo.User"</span></span><br><span class="line"><span class="xml">      flushCache="true"</span></span><br><span class="line"><span class="xml">      statementType="PREPARED"</span></span><br><span class="line"><span class="xml">      timeout="20"&gt;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p><p>以上就是一个模板配置， 哪些是必要配置，哪些是根据自己实际需求，看一眼就知道了。</p><p>下面， 还是用第一篇文章《深入浅出Mybatis系列（一）—Mybatis入门》里面的demo来示例吧：</p><h1 id="User类"><a href="#User类" class="headerlink" title="User类"></a>User类</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> deleteFlag;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//setter和getter方法省略...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="UserDao类"><a href="#UserDao类" class="headerlink" title="UserDao类"></a>UserDao类</h1><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">UserDao</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUser</span> (<span class="params">User user</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span> (<span class="params">User user</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span> (<span class="params">User user</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="userDao-xml"><a href="#userDao-xml" class="headerlink" title="userDao.xml"></a>userDao.xml</h1><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>   </span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE mapper   </span></span></span><br><span class="line"><span class="xml">PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"  </span></span><br><span class="line"><span class="xml">"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd"&gt; </span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.dy.dao.UserDao"</span>&gt;</span></span></span><br><span class="line"><span class="xml">   </span></span><br><span class="line"><span class="xml">   <span class="comment">&lt;!-- 对应userDao中的insertUser方法，  --&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertUser"</span> <span class="attr">parameterType</span>=<span class="string">"com.dy.entity.User"</span>&gt;</span></span></span><br><span class="line"><span class="xml">           insert into user(id, name, password, age, deleteFlag) </span></span><br><span class="line"><span class="xml">               values(#</span><span class="template-variable">&#123;id&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">, #</span><span class="template-variable">&#123;name&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">, #</span><span class="template-variable">&#123;password&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">, #</span><span class="template-variable">&#123;age&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">, #</span><span class="template-variable">&#123;deleteFlag&#125;</span><span class="xml">)</span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span></span><br><span class="line"><span class="xml">   </span></span><br><span class="line"><span class="xml">   <span class="comment">&lt;!-- 对应userDao中的updateUser方法 --&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateUser"</span> <span class="attr">parameterType</span>=<span class="string">"com.dy.entity.User"</span>&gt;</span></span></span><br><span class="line"><span class="xml">           update user set name = #</span><span class="template-variable">&#123;name&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">, password = #</span><span class="template-variable">&#123;password&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">, age = #</span><span class="template-variable">&#123;age&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">, deleteFlag = #</span><span class="template-variable">&#123;deleteFlag&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">               where id = #</span><span class="template-variable">&#123;id&#125;</span><span class="xml">;</span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span></span><br><span class="line"><span class="xml">   <span class="comment">&lt;!-- 对应userDao中的deleteUser 方法 --&gt;</span> </span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteUser"</span> <span class="attr">parameterType</span>=<span class="string">"com.dy.entity.User"</span>&gt;</span></span></span><br><span class="line"><span class="xml">           delete from user where id = #</span><span class="template-variable">&#123;id&#125;</span><span class="xml">;</span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>这样，一个简单的映射关系就建立了。仔细观察上面parameterType,  “com.dy.entity.User”，包名要是再长点呢，每次都这样写，写得蛋疼了。别忘了之前讲的 typeAliases（别名）， 那么这个地方，用上别名，岂不是技能跟蛋疼的长长的包名说拜拜了。好啦，咱们配上别名，在哪儿配？ 当然是在mybatis 的全局配置文件（我这儿名字是mybatis-conf.xml）， 不要认为是在mapper的配置文件里面配置哈。</p><h1 id="mybatis-conf-xml"><a href="#mybatis-conf-xml" class="headerlink" title="mybatis-conf.xml"></a>mybatis-conf.xml</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      通过package, 可以直接指定package的名字， mybatis会自动扫描你指定包下面的javabean,</span></span><br><span class="line"><span class="comment">      并且默认设置一个别名，默认的名字为： javabean 的首字母小写的非限定类名来作为它的别名。</span></span><br><span class="line"><span class="comment">      也可在javabean 加上注解@Alias 来自定义别名， 例如： @Alias(user) </span></span><br><span class="line"><span class="comment">      &lt;package name="com.dy.entity"/&gt;</span></span><br><span class="line"><span class="comment">       --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"user"</span> <span class="attr">type</span>=<span class="string">"com.dy.entity.User"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这样，一个别名就取好了，咱们可以把上面的 com.dy.entity.User 都直接改为user 了。 这多方便呀！</p><p>我这儿数据库用的是mysql, 我把user表的主键id 设置了自动增长， 以上代码运行正常， 那么问题来了（当然，我不是要问学挖掘机哪家强），我要是换成oracle数据库怎么办？ oracle 可是不支持id自增长啊？ 怎么办？请看下面：<br><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="comment">&lt;!-- 对应userDao中的insertUser方法，  --&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertUser"</span> <span class="attr">parameterType</span>=<span class="string">"com.dy.entity.User"</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="comment">&lt;!-- oracle等不支持id自增长的，可根据其id生成策略，先获取id </span></span></span><br><span class="line"><span class="xml">           </span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">resultType</span>=<span class="string">"int"</span> <span class="attr">order</span>=<span class="string">"BEFORE"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span>&gt;</span></span></span><br><span class="line"><span class="xml">              select seq_user_id.nextval as id from dual</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span></span><br><span class="line"><span class="xml">        </span></span><br><span class="line"><span class="xml">        --&gt;   </span></span><br><span class="line"><span class="xml">           insert into user(id, name, password, age, deleteFlag) </span></span><br><span class="line"><span class="xml">               values(#</span><span class="template-variable">&#123;id&#125;</span><span class="xml">, #</span><span class="template-variable">&#123;name&#125;</span><span class="xml">, #</span><span class="template-variable">&#123;password&#125;</span><span class="xml">, #</span><span class="template-variable">&#123;age&#125;</span><span class="xml">, #</span><span class="template-variable">&#123;deleteFlag&#125;</span><span class="xml">)</span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p><p>同理，如果我们在使用mysql的时候，想在数据插入后返回插入的id, 我们也可以使用 selectKey 这个元素：<br><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="comment">&lt;!-- 对应userDao中的insertUser方法，  --&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertUser"</span> <span class="attr">parameterType</span>=<span class="string">"com.dy.entity.User"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">oracle等不支持id自增长的，可根据其id生成策略，先获取id </span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">resultType</span>=<span class="string">"int"</span> <span class="attr">order</span>=<span class="string">"BEFORE"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span>&gt;</span></span></span><br><span class="line"><span class="xml">              select seq_user_id.nextval as id from dual</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span></span><br><span class="line"><span class="xml">        --&gt; </span></span><br><span class="line"><span class="xml">        </span></span><br><span class="line"><span class="xml">        <span class="comment">&lt;!-- mysql插入数据后，获取id --&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span> <span class="attr">resultType</span>=<span class="string">"int"</span> <span class="attr">order</span>=<span class="string">"AFTER"</span> &gt;</span></span></span><br><span class="line"><span class="xml">               SELECT LAST_INSERT_ID() as id</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span></span><br><span class="line"><span class="xml">          </span></span><br><span class="line"><span class="xml">        insert into user(id, name, password, age, deleteFlag) </span></span><br><span class="line"><span class="xml">                values(#</span><span class="template-variable">&#123;id&#125;</span><span class="xml">, #</span><span class="template-variable">&#123;name&#125;</span><span class="xml">, #</span><span class="template-variable">&#123;password&#125;</span><span class="xml">, #</span><span class="template-variable">&#123;age&#125;</span><span class="xml">, #</span><span class="template-variable">&#123;deleteFlag&#125;</span><span class="xml">)</span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p><p>这儿，我们就简单提一下 <selectkey> 这个元素节点吧:<br><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">selectKey</span></span></span></span><br><span class="line"><span class="xml">        <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">selectKey 语句结果应该被设置的目标属性。如果希望得到多个生成的列，</span></span><br><span class="line"><span class="xml">也可以是逗号分隔的属性名称列表。 </span></span><br><span class="line"><span class="xml">--&gt;</span></span><br><span class="line"><span class="xml">        keyProperty="id"</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">        <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">结果的类型。MyBatis 通常可以推算出来，但是为了更加确定写上也不会有什么问题。</span></span><br><span class="line"><span class="xml">MyBatis 允许任何简单类型用作主键的类型，包括字符串。如果希望作用于多个生成的列，</span></span><br><span class="line"><span class="xml">则可以使用一个包含期望属性的 Object 或一个 Map。 </span></span><br><span class="line"><span class="xml">--&gt;</span></span><br><span class="line"><span class="xml">        resultType="int"</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">        <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">这可以被设置为 BEFORE 或 AFTER。如果设置为 BEFORE，那么它会首先选择主键，</span></span><br><span class="line"><span class="xml">设置 keyProperty 然后执行插入语句。如果设置为 AFTER，那么先执行插入语句，</span></span><br><span class="line"><span class="xml">然后是 selectKey 元素 - 这和像 Oracle 的数据库相似，在插入语句内部可能有嵌入索引调用。 </span></span><br><span class="line"><span class="xml">--&gt;</span></span><br><span class="line"><span class="xml">        order="BEFORE"</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">        <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="xml">与前面相同，MyBatis 支持 STATEMENT，PREPARED 和 CALLABLE 语句的映射类型，</span></span><br><span class="line"><span class="xml">分别代表 PreparedStatement 和 CallableStatement 类型。 </span></span><br><span class="line"><span class="xml">--&gt;</span></span><br><span class="line"><span class="xml">        statementType="PREPARED"&gt;</span></span><br></pre></td></tr></table></figure></selectkey></p><p>好啦，本篇文章主要介绍了insert, update, delete的配置及用法。 下篇文章将介绍复杂的 select相关的配置及用法， 待这些都讲完后，会先根据源码分析一下mybatis的整个运行流程，然后再深入mybatis的用法。</p><hr>]]></content:encoded>
      
      
    </item>
    
  </channel>
</rss>
